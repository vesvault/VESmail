# VESmail Configuration File
# https://vesmail.email
#
# This is a strict JSON formatted configuration,
# except that comment lines starting with '#', '//' or ';'
# are permitted anywhere in the file and are ignored
#

{

# Global configuration options, apply to all VESmail services
    "*": {

# VESmail Proxy Access List
# A complete VES URL (http://ves.host) of the acl object,
# or an object reference in domain "vesmail"
# If the acl is provided - the proxy access will be granted only
# to VES users whom the acl object is shared with.
;	"acl": "acme@example.com!acl",

# Unencrypted banner parts to be added to an encrypted VESmail message
# Each part must contain proper MIME headers
# VESmail will resolve {$...} template variables and inject each banner
# as a part of multipart/alternative, but won't change the transfer
# encoding or apply any other transformation.
# Supported variables:
#   {$url}	- the VESmail Now url for viewing the current email message,
#		  generated by appending the properly escaped message id to
#		  the base specified in "now-url" config value
#   {$app.*}	- a value of a corresponding property from the manifest app
#		  section, the manifest file path to be supplied in the
#		  "manifest" config property, the app section href is matched
#		  against the "now-url" config value
	"banner": [
	    "/etc/vesmail/vesmail-banner-txt",
	    "/etc/vesmail/vesmail-banner-html"
	],

# VES Manifest file path. The manifest is parsed to populate {app.*} vars
# in the encrypted message banners
	"manifest": "/etc/vesmail/ves.json",

# Subject: header plaintext value for an encrypted message.
	"subject": "<VESmail Encrypted Message>",

# TLS Server options
	"tls": {

# TLS / SSL Certificate path.
# The certificate is used to run TLS on inbound connections to VESmail proxy,
# persistent or STARTTLS, depending on how the process is invoked.
# The certificate file must include the required chain certificates
;	    "cert": "/etc/vesmail/vesmail.crt",

# PEM private key matching the cert
# This file must be readably by VESmail processes that use inbound TLS
;	    "pkey": "/etc/vesmail/vesmail.pem",

# TLS level, none | optional | unsecure | medium | high
;	    "level": "high"
	}

# VESmail Now instant viewer options
	"now": {

# VESmail Now spool directory
# Store encrypted send emails for VESmail Now viewer
# Must be writable for sending processes
	    "dir": "/var/spool/VESmail/now",

# VESmail Now URL
# Communicated to the recipiend, appended with the Message ID
# This URL should open the VESmail Now viewer for the specific message id
	    "url": "https://vesmail.example.com/now/?msgid=",

# Maximum size of an encrypted message spooled for the instant viewer.
# Larger messages will be truncated in the viewer.
	    "maxsize": 1048576

	},
# Corporate Compliance Audit
# Encryption keys for ALL outgoing encrypted emails will be shared with the
# specified list of emails or ves vault key urls.
# The emails are NOT automatically bcc'd to the audit emails, see "bcc" option
;	"audit": [
;	    "bigbrother@example.com"
;	],

# Configuration overrides for a host name received from TLS SNI
# The override config file name is {prefix}{SNI_hostname}{suffix}
# Every override config file is in the same format as the main vesmail.conf,
# is loaded before the TLS negotiation is finalized and may override the TLS
# settings
	"sni": {
	    "prefix": "/etc/vesmail/sni/",
	    "suffix": "/vesmail.conf",

# If set to true - TLS negotiation will fail if the override config file
# is missing or is not parsable
	    "require": false
	},

# A path for storing VESkeys for CLI encrypt/decrypt operations.
# An account name is appended to get the filename for the VESkey,
# trailing slashes are not automatically added.
	"veskey-dir": "/etc/vesmail/veskeys/",

# Abuse protection system sensitivity level.
# Protects the VESmail proxy instance from being used as a brute force relay.
# 0 (default) disables the abuse protection, applicable for localhost or for
# an access controlled private server.
# 360 is the threshold for one failed or 10 seccussful login attemptss to a
# remote server.
# The recommended value for a publicly accessible instance is 80.
# Since the abuse tracking data is stored in the local memory of the process,
# the abuse protection works only in a daemon mode, each daemon process has its
# own abuse context, and the context is reset upon the daemon is restarted.
	"abuse-sense": 0,

# Profile level configuration overrides:
# "allow"    load and apply override settings for a profile that has been
#            created on a private or enterprise VESmail instance
#            The following values can be overriden by the external url:
#            "audit", "bcc", "now-url", "banner-content"
#            Overrides are useful for a local VESmail instance
# "deny"     Reject VESmail logins with profiles that refer an override,
#            a reasonable option for a public VESmail instance
# "ignore"   Ignore any overrides, an option for a private VESmail server
#            with an ACL
# "auto"     Ignore if ACL is set, allow otherwise; the default value
	"overrides": "auto"

    },

# Overrides and specific settings for IMAP proxy service
    "imap": {

# Buffering threshold for the IMAP proxy
# Should be greater than any reasonable size of RFC822 headers of any message
# or any MIME part
# 1M is the recommended default
	"maxbuf": 1048576
    },

# Overrides and specific settings for SMTP proxy service
    "smtp": {

# A list of email addresses to automatically bcc all outgoing smtp messages.
# Useful for archives and certain setups of VESmail Now viewer.
# The encryption keys will NOT be automatically shared with the VESmail vaults
# matching the bcc addresses - use in conjunction with "audit" to do so.
# Note: Do not bcc to an actual email address that is not on the "audit" list
# and uses VESmail IMAP - the undecryptable messages may confuse the client.
;	"bcc": [
;	    "archive@example.com"
;	]
    },

# Overrides and specific settings for VESmail Now HTTP mini server
    "now": {
    },

# Daemons to be run by the internal daemonizer
    "daemons": [
	{
	    "server": "imap",
	    "host": "",
	    "port": 7143
	},
	{
	    "server": "imap",
	    "host": "",
	    "port": 7193,
	    "tls": {
		"persist": true
	    }
	},
	{
	    "server": "smtp",
	    "host": "",
	    "port": 7125
	},
	{
	    "server": "smtp",
	    "host": "",
	    "port": 7165,
	    "tls": {
		"persist": true
	    }
	},
	{
	    "server": "now",
	    "host": "",
	    "port": 7183,
	    "tls": {
		"persist": true
	    },
	    "now": {

# Additional HTTP headers to be sent with VESmail Now responses
		"headers": [
		    "Access-Control-Allow-Headers: *",
		    "Access-Control-Allow-Methods: *",
		    "Access-Control-Allow-Origin: *",
		    "Access-Control-Max-Age: 86400"
		]
	    }
	}
    ]
}
