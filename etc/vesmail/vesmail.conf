# VESmail Configuration File
# https://vesmail.email
#
# This is a strict JSON formatted configuration,
# except that comment lines starting with '#', '//' or ';'
# are permitted anywhere in the file and are ignored
#

{

# Global configuration options, apply to all VESmail services
    "*": {

# VESmail Proxy Access List
# A complete VES URL (http://ves.host) of the acl object,
# or an object reference in domain "vesmail"
# If the acl is provided - the proxy access will be granted only
# to VES users whom the acl object is shared with.
	"acl": "acme@example.com!acl",

# Unencrypted banner parts to be added to an encrypted VESmail message
# Each part must contain proper MIME headers
# VESmail will resolve {$...} template variables and inject each banner
# as a part of multipart/alternative, but won't change the transfer
# encoding or apply any other transformation.
# Supported variables:
#   {$url}	- the VESmail Now url for viewing the current email message,
#		  generated by appending the properly escaped message id to
#		  the base specified in "now-url" config value
#   {$app.*}	- a value of a corresponding property from the manifest app
#		  section, the manifest file path to be supplied in the
#		  "manifest" config property, the app section href is matched
#		  against the "now-url" config value
	"banner": [
	    "/etc/vesmail/vesmail-banner-txt",
	    "/etc/vesmail/vesmail-banner-html"
	],

# VES Manifest file path. The manifest is parsed to populate {app.*} vars
# in the encrypted message banners
	"manifest": "/etc/vesmail/ves.json",

# Subject: header plaintext value for an encrypted message.
	"subject": "<VESmail Encrypted Message>",

# SSL Certificate path.
# The certificate is used to run TLS on inbound connections to VESmail proxy,
# persistent or STARTTLS, depending on how the process is invoked.
# The certificate file must include the required chain certificates
	"cert": "/etc/vesmail/vesmail.crt",

# PEM private key matching the cert
# This file must be readably by VESmail processes that use inbound TLS
	"pkey": "/etc/vesmail/vesmail.pem",

# VESmail Now spool directory
# Store encrypted send emails for VESmail Now viewer
# Must be writable for sending processes
	"now-dir": "/var/spool/VESmail/now",

# VESmail Now URL
# Communicated to the recipiend, appended with the Message ID
# This URL should open the VESmail Now viewer for the specific message id
	"now-url": "https://vesmail.example.com/now/?msgid=",

# Configuration overrides for a host name received from TLS SNI
# The override config file name is {prefix}{SNI_hostname}{suffix}
# Every override config file is in the same format as the main vesmail.conf,
# is loaded before the TLS negotiation is finalized and may override the TLS
# settings
	"sni": {
	    "prefix": "/etc/vesmail/sni/",
	    "suffix": "/vesmail.conf",

# If set to true - TLS negotiation will fail if the override config file
# is missing or is not parsable
	    "require": false
	},

# A path for storing VESkeys for CLI encrypt/decrypt operations.
# An account name is appended to get the filename for the VESkey,
# trailing slashes are not automatically added.
	"veskey-dir": "/etc/vesmail/veskeys/"

    },

# Overrides and specific settings for IMAP proxy service
    "imap": {

# Buffering threshold for the IMAP proxy
# Should be greater than any reasonable size of RFC822 headers of any message or any MIME part,
# 1M is the recommended default
	"maxbuf": 1048576
    },

# Overrides and specific settings for SMTP proxy service
    "smtp": {
    },

# Overrides and specific settings for VESmail Now HTTP mini server
    "now": {
    },

# Daemons to be run by the internal daemonizer
    "daemons": [
	{
	    "server": "imap",
	    "host": "*",
	    "port": 7143
	},
	{
	    "server": "imap",
	    "host": "*",
	    "port": 7193,
	    "tls": {
		"persist": true
	    }
	},
	{
	    "server": "smtp",
	    "host": "*",
	    "port": 7125
	},
	{
	    "server": "smtp",
	    "host": "*",
	    "port": 7165,
	    "tls": {
		"persist": true
	    }
	}
    ]
}
